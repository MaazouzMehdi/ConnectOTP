<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Chapter 3. Generate MobilityDB trips</title><link rel="stylesheet" type="text/css" href="docbook.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index.html" title="ConnectOTP : Workshop"><link rel="up" href="index.html" title="ConnectOTP : Workshop"><link rel="prev" href="ch02s04.html" title="Prepare QGIS"><link rel="next" href="ch03s02.html" title="People moving in Brussels"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 3. Generate MobilityDB trips</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch02s04.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ch03s02.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="generating_mobilityDB_trips"></a>Chapter 3. Generate MobilityDB trips</h1></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="sect1"><a href="ch03.html#multi_modal_trip">A Multi-Modal Trip</a></span></dt><dt><span class="sect1"><a href="ch03s02.html">People moving in Brussels</a></span></dt><dt><span class="sect1"><a href="ch03s03.html">Comparison with alternatives itineraries</a></span></dt></dl></div><p>Once the various tools have been installed and configured. We can start generating MobilityDB trips from trips obtained via OpenTripPlanner.</p><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="multi_modal_trip"></a>A Multi-Modal Trip</h2></div></div></div><p>First, we will generate a multi-modal trip for a person wanting to travel from a point A to a point B in Brussels.
        To do this, we will randomly generate a source and a target nodes that will be used in the calculation of the trip.</p><pre class="programlisting">
$ psql -h localhost -U postgres -d brusselsOTP  -f ./src/combination.sql -v o=1
-- -v o=1 means we want to generate 1 source node and 1 target node
	    </pre><p>We will now contact the OpenTripPlanner API to generate the trip, and parse it into a PostgreSQL database called <code class="varname">routes</code>.
                    Please make sure you have started the OTP server before doing this.</p><pre class="programlisting">
-- in a console at the root of your project :
$ python ./src/manageOTP.py localhost brusselsOTP dbowner password 

-- as usual, replace dbowner by your database user
-- replace password by your database user's password
      </pre><p>Running this command will prompt you to enter parameters to better define the trip you want to create.
                      Below are some examples of parameters you might want to enter. OpenTripPlanner is full of parameters, a exhaustive list can be found at this <a class="ulink" href="http://dev.opentripplanner.org/apidoc/1.0.0/resource_PlannerResource.html" target="_top">address</a></p><p> the desired format is presented as follows : <code class="varname">key=value</code></p><p>Here is an example you could enter in the console when you run <code class="varname">manageOTP.py</code></p><pre class="programlisting">
please enter the desired parameters ( key=value ) : arriveBy=true optimize=QUICK
      </pre><p>You could found below some parameters you put enter :</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>date=2022-03-10</p></li><li class="listitem"><p>time=13:23</p></li><li class="listitem"><p>mode=WALK,BIKE (represents transport modes to consider)</p></li><li class="listitem"><p>wheelchair=true</p></li><li class="listitem"><p>arriveBy=true (specifies that the given time is when we plan to arrive)</p></li><li class="listitem"><p>maxWalkDistance=1000 (specifies the maximum distance in meters that you are willing to walk)</p></li></ul></div><p>If you wish, you can press "Enter" directly. In this way, the default values will be taken into account.
                      Note that the default <code class="varname">date</code> represents the current day, the default <code class="varname">time</code> represents the current time.</p><p>Please note that the baseline GTFS data covers the months of March 2022. If you are doing this workshop later, please enter a specific date that is taken into account by the GTFS data</p><p>For the sake of this workshop, we have changed the default value of the <code class="varname">mode</code>parameter. Originally <code class="varname">WALK</code>, it is now <code class="varname">WALK,TRANSIT</code>.
                      The reason being that this workshop deals with multi-modal routing, so there is no point in using only your feet to do the trips. Moreover, we changed the default value <code class="varname">numItineraries=1</code> by  <code class="varname">numItineraries=2</code> mainly because the default value only takes account the WALK trip.</p><p>In our case, when the prompt below appears, we click immediately on Enter </p><pre class="programlisting">
please enter the desired parameters ( key=value ) :
      </pre><p>Now we just need to run one last sql script to generate the mobility trip.</p><pre class="programlisting">
-- in a console at the root of your project
$ psql -h localhost -U dbowner -d brusselsOTP  -f ./src/generateMobility_Trips.sql -v itineraries=false
-- We generate MobilityDB trips
       </pre><p>We now have the mobilitytrips table containing our tgeompoints.
        As well as a table <code class="varname">stibtrip</code> containing our tgeompoints which represents the part by public transport, a table <code class="varname">waittrip</code> which represents the waiting for a transfer and a table <code class="varname">walktrip</code> which represents walking part.</p><p>Now let's go to Qgis and open a connection to our BrusselsOTP Database. Once done, click on the <code class="varname">optstart</code> and <code class="varname">opttarget</code> tables to display the source node and taget node. The generated nodes are random, so there is a good chance that you will have other nodes</p><p>We can display our <code class="varname">mobilitytrips</code> table on QGis. However, in order to be able to visualize our points (people) moving in time, we will use the Move module.</p><p>In order to visualize the points in a temporal way, we just need to use the Move plugin (installed previously). Click on the plugin to display a window at the bottom where you insert the 
                      following queries and then, click on execute. This will create temporal layers. Open the controller panel (View-&gt;Panels-&gt;Temporal Controller Panel) and you can then see the moving points move over time.</p><pre class="programlisting">
-- on the plugin Move in Qgis
select trip as walktrip from walktrip
select trip as waittrip from waittrip
select trip as stibtrip from stibtrip
      </pre><p>Please note that in Belgium we are in UTC+1. I'm currently having trouble displaying the correct time on Move.
                      Therefore, if you generate trips between 04:00 pm and 04:30 pm for example, the display of the points on Move will be between 03:00 pm and 03h30 pm.</p><p>You should have a similar result, the green dot representing the person walking, the red dot representing the person moving in a public transport (tram, bus, metro) and the yellow dot representing the person waiting for a transfer</p><p>
				  <span class="inlinemediaobject"><img src="../images/advancedtripfoot.png" width="625"></span>
      </p><p>
				  <span class="inlinemediaobject"><img src="../images/advancedtripstib.png" width="625"></span>
      </p><p>
				  <span class="inlinemediaobject"><img src="../images/advancedtripwait.png" width="625"></span>
      </p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch02s04.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ch03s02.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Prepare QGIS </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> People moving in Brussels</td></tr></table></div></body></html>
